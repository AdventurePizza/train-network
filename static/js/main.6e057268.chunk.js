(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{294:function(e,t,n){},312:function(e,t){},318:function(e,t){},319:function(e,t){},344:function(e,t){},346:function(e,t){},356:function(e,t){},358:function(e,t){},368:function(e,t){},370:function(e,t){},479:function(e,t){},481:function(e,t){},486:function(e,t){},488:function(e,t){},495:function(e,t){},507:function(e,t){},510:function(e,t){},515:function(e,t){},624:function(e,t,n){"use strict";n.r(t);n(294);var r,c=n(1),a=n.n(c),s=n(661),o=n(3),u=n(34),i=n(36),b=n(660),l=n.p+"static/media/spinner.d99b4eae.svg",f=n(93),j=n(659),p=n(170),h=n.n(p),d=n(21);try{r=new h.a(ethereum)}catch(q){console.log("Please use the metamask extension")}var O={1:"ethereum",56:"BSC",97:"BSC testnet",137:"polygon",80001:"mumbai"},x=function(e){return[{type:"string",name:"Message",value:"Hi, please sign in"},{type:"string",name:"One-time nonce",value:e}]},v=a.a.createContext({jwt:"",signIn:function(){},isLoggedIn:!1}),g=function(e){var t=Object(c.useState)(!1),n=Object(i.a)(t,2),a=n[0],s=n[1],b=Object(c.useState)(""),l=Object(i.a)(b,2),f=l[0],p=l[1],h=Object(c.useState)(""),x=Object(i.a)(h,2),g=x[0],m=x[1],w=Object(c.useState)(""),y=Object(i.a)(w,2),C=y[0],S=y[1],I=Object(c.useState)(),A=Object(i.a)(I,2),T=A[0],M=A[1],E=Object(c.useState)(!1),B=Object(i.a)(E,2),N=B[0],J=B[1],W=Object(c.useState)(),L=Object(i.a)(W,2),q=L[0],_=L[1],z=function(){var e=Object(u.a)(Object(o.a)().mark((function e(t){var n,r,c;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=new j.a.Web3Provider(window.ethereum),e.next=4,n.getBalance(t);case 4:r=e.sent,c=j.b.formatEther(r),console.log(c),p(c),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(0),console.log(e.t0),p("unknown");case 14:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t){return e.apply(this,arguments)}}(),D=Object(c.useCallback)(function(){var e=Object(u.a)(Object(o.a)().mark((function e(t){var n;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n="",0===t.length?console.log("Please connect to MetaMask."):t[0]!==q&&(n=t[0],z(t[0])),_(n);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[q]),H=Object(c.useCallback)(function(){var e=Object(u.a)(Object(o.a)().mark((function e(t){return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var c;"string"===typeof t&&(t=parseInt(t,16));var a=O[t]||"Unknown";r.eth.getAccounts().then(function(){var t=Object(u.a)(Object(o.a)().mark((function t(n){return Object(o.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n&&n.length?(c=n[0],z(n[0]),e({accountId:c,network:a}),S(a)):("No metamask account found, connect metamask",e({error:"No metamask account found, connect metamask"}));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[]),R=Object(c.useCallback)((function(){return new Promise(function(){var e=Object(u.a)(Object(o.a)().mark((function e(t){var n;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(window.ethereum){e.next=2;break}return e.abrupt("return",null);case 2:return e.next=4,ethereum.request({method:"eth_chainId"});case 4:n=e.sent,console.log(n),H(n),ethereum.on("chainChanged",H),ethereum.request({method:"eth_requestAccounts"}).then((function(e){var n;D(e);var r=new j.a.Web3Provider(ethereum,"any");M(r),t(null!==(n=e[0])&&void 0!==n?n:null)})).catch((function(e){4001===e.code?console.log("Please connect to MetaMask."):console.error(e)}));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}),[D,H]),G=Object(c.useCallback)((function(t,n){J(!0),_(t.publicAddress),m(n),localStorage.setItem("jwt",n),e.socket.emit("authenticate",{token:n});var r=new j.a.Web3Provider(ethereum,"any");M(r)}),[e.socket]),K=Object(c.useCallback)((function(e,t){return new Promise(function(){var n=Object(u.a)(Object(o.a)().mark((function n(c,a){var s;return Object(o.a)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return P(t).then(function(){var n=Object(u.a)(Object(o.a)().mark((function n(r){var a;return Object(o.a)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!r.ok||!e){n.next=8;break}return n.next=3,r.json();case 3:a=n.sent,G(a,t),c({}),n.next=9;break;case 8:c({error:r.statusText});case 9:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()),n.prev=1,n.next=4,r.eth.net.getId();case 4:return s=n.sent,n.next=7,H(s);case 7:n.next=12;break;case 9:n.prev=9,n.t0=n.catch(1),console.log(n.t0);case 12:case"end":return n.stop()}}),n,null,[[1,9]])})));return function(e,t){return n.apply(this,arguments)}}())}),[G,H]),U=Object(c.useCallback)(Object(u.a)(Object(o.a)().mark((function e(){var t,n,r,c;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s(!0),t=localStorage.getItem("jwt"),n=q,q){e.next=10;break}return e.next=6,R();case 6:if(e.t0=e.sent,e.t0){e.next=9;break}e.t0="";case 9:n=e.t0;case 10:if(!n){e.next=26;break}if(!t){e.next=22;break}return e.next=14,K(n,t);case 14:if(!e.sent.error){e.next=20;break}return e.next=18,k(n);case 18:r=e.sent,K(n,r);case 20:e.next=26;break;case 22:return e.next=24,k(n);case 24:c=e.sent,K(n,c);case 26:case"end":return e.stop()}}),e)}))),[K,q,R]);Object(c.useEffect)((function(){a||U()}),[U,a]);var F=function(){var e=Object(u.a)(Object(o.a)().mark((function e(){var t,n,r,c;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("signIN"),t=localStorage.getItem("jwt"),n=q,!q){e.next=7;break}t&&K(q,t),e.next=19;break;case 7:return e.prev=7,e.next=10,R();case 10:if(null!==(r=e.sent)){e.next=13;break}return e.abrupt("return",alert("error signing in"));case 13:n=r,e.next=19;break;case 16:return e.prev=16,e.t0=e.catch(7),e.abrupt("return",console.log("error connecting"));case 19:if(n){e.next=21;break}return e.abrupt("return");case 21:return e.next=23,k(n);case 23:c=e.sent,K(n,c);case 25:case"end":return e.stop()}}),e,null,[[7,16]])})));return function(){return e.apply(this,arguments)}}();return Object(d.jsx)(v.Provider,{value:{jwt:g,signIn:F,accountId:q,isLoggedIn:N,provider:T,network:C,balance:f},children:e.children})},k=function(){var e=Object(u.a)(Object(o.a)().mark((function e(t){var n,r,c,a,s,u,i,b;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m(t);case 2:if(n=e.sent){e.next=11;break}return e.next=6,y(t);case 6:a=e.sent,r=a.publicAddress,c=a.nonce,e.next=13;break;case 11:r=n.publicAddress,c=n.nonce;case 13:return e.next=15,C(r,c);case 15:return s=e.sent,u=s.signature,e.next=19,w(r,u);case 19:return i=e.sent,b=i.accessToken,e.abrupt("return",b);case 22:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),m=function(e){return fetch(S+"/users/".concat(e)).then((function(e){return e.json()})).then(function(){var e=Object(u.a)(Object(o.a)().mark((function e(t){return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.nonce&&t.publicAddress){e.next=2;break}return e.abrupt("return",null);case 2:return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},w=function(e,t){return fetch(S+"/auth",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({publicAddress:e,signature:t})}).then((function(e){return e.json()}))},y=function(e){return fetch(S+"/users",{body:JSON.stringify({publicAddress:e}),headers:{"Content-Type":"application/json"},method:"POST"}).then((function(e){return e.json()}))};function C(e,t){return new Promise((function(n,c){var a;r&&r.currentProvider||(r=new h.a(ethereum)),null===(a=r.currentProvider)||void 0===a||a.sendAsync({method:"eth_signTypedData",params:[x(t),e],from:e},(function(t,r){if(t)return console.error(t);r.error&&(console.error(r.error.message),c(r.error.message)),n({publicAddress:e,signature:r.result})}))}))}var S="https://train-network.herokuapp.com",P=function(e){return fetch(S+"/users/auth",{method:"POST",headers:{Authorization:"Bearer "+e}})},I=a.a.createContext({getMessages:function(){return Promise.resolve({isSuccessful:!1})},postMessage:function(){return Promise.resolve({isSuccessful:!1})}}),A=function(e){var t=e.children,n=Object(c.useContext)(v),r=n.isLoggedIn,a=n.jwt,s=Object(c.useCallback)((function(e,t){return fetch("https://train-network.herokuapp.com"+e,Object(f.a)(Object(f.a)({},t),{},{headers:r&&a?Object(f.a)(Object(f.a)({},t.headers),{},{Authorization:"Bearer "+a}):Object(f.a)({},t.headers)}))}),[a,r]),i=Object(c.useCallback)(function(){var e=Object(u.a)(Object(o.a)().mark((function e(t){var n;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s("chatRouter/messages",{method:"GET"});case 2:if(!(n=e.sent).ok){e.next=7;break}return e.next=6,n.json();case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[s]),b=Object(c.useCallback)(function(){var e=Object(u.a)(Object(o.a)().mark((function e(t){var n;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s("chatRouter/message",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:t})});case 2:if(!(n=e.sent).ok){e.next=7;break}return e.next=6,n.json();case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[s]);return Object(d.jsx)(I.Provider,{value:{getMessages:i,postMessage:b},children:t})},T=function(e){var t=e.socket,n=a.a.useState(""),r=Object(i.a)(n,2),f=r[0],j=r[1],p=a.a.useState([]),h=Object(i.a)(p,2),O=h[0],x=h[1],g=a.a.useState(!1),k=Object(i.a)(g,2),m=k[0],w=k[1],y=Object(c.useContext)(I),C=y.postMessage,S=y.getMessages,P=Object(c.useContext)(v).accountId;function A(){return T.apply(this,arguments)}function T(){return(T=Object(u.a)(Object(o.a)().mark((function e(){return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return w(!0),e.prev=1,e.next=4,C({address:P,content:f});case 4:x([{address:P,content:f,timestamp:Date.now()}].concat(O)),j(""),w(!1),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(1),console.log(e.t0),w(!1);case 13:case"end":return e.stop()}}),e,null,[[1,9]])})))).apply(this,arguments)}Object(c.useEffect)((function(){var e=function(e){console.log("newmessage"),console.log(e),x([e].concat(O))};return t.on("newMessage",e),function(){t.off("newMessage",e)}}),[t,O]);return Object(c.useEffect)((function(){function e(){return(e=Object(u.a)(Object(o.a)().mark((function e(){var t;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S();case 2:t=e.sent,console.log(t),x(t);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[S]),Object(d.jsx)("div",{style:{display:"flex",justifyContent:"center"},children:Object(d.jsx)("div",{style:{width:"70vw",marginTop:20},children:Object(d.jsxs)("div",{children:[Object(d.jsx)(b.a,{label:"Type here",variant:"outlined",value:f,onChange:function(e){e.target.value.length<510&&j(e.target.value)},onKeyPress:function(e){"Enter"===e.key&&A()},fullWidth:!0}),Object(d.jsx)(s.a,{fullWidth:!0,onClick:Object(u.a)(Object(o.a)().mark((function e(){return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:A();case 1:case"end":return e.stop()}}),e)}))),children:m?Object(d.jsx)("img",{alt:"loading",src:l,style:{width:60}}):"Post"}),Object(d.jsxs)("div",{children:[Object(d.jsx)("br",{}),O&&O.map((function(e){return Object(d.jsxs)("div",{children:[e.content,Object(d.jsx)("br",{}),Object(d.jsx)("div",{style:{textAlign:"right"},children:Object(d.jsx)("b",{style:{textAlign:"right",padding:10},children:e.address})}),Object(d.jsx)("br",{}),Object(d.jsx)("br",{})]},e.timestamp)}))]})]})})})};var M=function(e){var t=e.socket,n=Object(c.useContext)(v),r=n.isLoggedIn,a=n.accountId,o=n.balance,u=n.signIn;return Object(d.jsxs)("div",{style:{height:"100%",backgroundColor:"white"},children:[r?Object(d.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[Object(d.jsx)("div",{children:o+" ETH"}),Object(d.jsx)("div",{style:{textAlign:"right"},children:a})]}):Object(d.jsx)("div",{children:Object(d.jsx)(s.a,{onClick:function(){u()},children:" Sign In"})}),Object(d.jsx)(T,{socket:t})]})},E=n(28),B=n.n(E),N=n(287),J=n.n(N),W="localhost"===window.location.hostname?"ws://localhost:8000":"wss://train-network.herokuapp.com",L=J()(W,{transports:["websocket"]});B.a.render(Object(d.jsx)(g,{socket:L,children:Object(d.jsx)(A,{children:Object(d.jsx)(M,{socket:L})})}),document.getElementById("root"))}},[[624,1,2]]]);
//# sourceMappingURL=main.6e057268.chunk.js.map